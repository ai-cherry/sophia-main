{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "version": "2.0",
  "metadata": {
    "name": "Sophia AI Knowledge Admin Dashboard",
    "description": "Knowledge base management and discovery system",
    "author": "Sophia AI Team",
    "createdAt": "2024-01-20",
    "theme": "dark"
  },
  "resources": [
    {
      "id": "sophia_api",
      "type": "restapi",
      "name": "Sophia AI Backend",
      "config": {
        "baseURL": "{{ environment.API_BASE_URL }}/api/v1",
        "headers": {
          "Authorization": "Bearer {{ localStorage.values.authToken }}",
          "Content-Type": "application/json"
        },
        "timeout": 30000
      }
    },
    {
      "id": "pinecone_db",
      "type": "restapi",
      "name": "Pinecone Vector DB",
      "config": {
        "baseURL": "https://{{ environment.PINECONE_INDEX }}.svc.{{ environment.PINECONE_ENVIRONMENT }}.pinecone.io",
        "headers": {
          "Api-Key": "{{ environment.PINECONE_API_KEY }}",
          "Content-Type": "application/json"
        }
      }
    },
    {
      "id": "file_upload",
      "type": "s3",
      "name": "Document Storage",
      "config": {
        "bucket": "{{ environment.S3_BUCKET }}",
        "region": "{{ environment.AWS_REGION }}",
        "accessKeyId": "{{ environment.AWS_ACCESS_KEY_ID }}",
        "secretAccessKey": "{{ environment.AWS_SECRET_ACCESS_KEY }}"
      }
    }
  ],
  "queries": [
    {
      "id": "getKnowledgeEntries",
      "resource": "sophia_api",
      "type": "GET",
      "endpoint": "/knowledge/entries?page={{ pagination.currentPage }}&limit={{ pagination.pageSize }}",
      "transformer": "return { data: formatDataAsArray(data.entries), total: data.total }"
    },
    {
      "id": "getPendingInsights",
      "resource": "sophia_api",
      "type": "GET",
      "endpoint": "/knowledge/pending-insights",
      "trigger": "onLoad",
      "transformer": "return formatDataAsArray(data.insights)"
    },
    {
      "id": "uploadDocument",
      "resource": "sophia_api",
      "type": "POST",
      "endpoint": "/knowledge/upload",
      "body": {
        "file": "{{ fileUploader.value[0] }}",
        "metadata": {
          "source": "{{ sourceInput.value }}",
          "tags": "{{ tagsInput.value }}",
          "priority": "{{ prioritySelect.value }}"
        }
      }
    },
    {
      "id": "createKnowledgeEntry",
      "resource": "sophia_api",
      "type": "POST",
      "endpoint": "/knowledge/entries",
      "body": {
        "content": "{{ contentEditor.value }}",
        "source": "{{ sourceInput.value }}",
        "tags": "{{ tagsInput.value }}",
        "priority": "{{ prioritySelect.value }}",
        "type": "{{ typeSelect.value }}"
      }
    },
    {
      "id": "testKnowledge",
      "resource": "sophia_api",
      "type": "POST",
      "endpoint": "/knowledge/test",
      "body": {
        "query": "{{ testQueryInput.value }}"
      }
    },
    {
      "id": "approveInsight",
      "resource": "sophia_api",
      "type": "POST",
      "endpoint": "/knowledge/insights/{{ selectedInsight.id }}/approve",
      "body": {
        "edited_content": "{{ insightEditor.value }}",
        "priority": "{{ insightPrioritySelect.value }}"
      }
    },
    {
      "id": "rejectInsight",
      "resource": "sophia_api",
      "type": "POST",
      "endpoint": "/knowledge/insights/{{ selectedInsight.id }}/reject",
      "body": {
        "reason": "{{ rejectionReason.value }}"
      }
    },
    {
      "id": "searchKnowledge",
      "resource": "sophia_api",
      "type": "POST",
      "endpoint": "/knowledge/search",
      "body": {
        "query": "{{ searchInput.value }}",
        "filters": {
          "tags": "{{ tagFilter.value }}",
          "source": "{{ sourceFilter.value }}",
          "dateRange": "{{ dateRangeFilter.value }}"
        }
      }
    }
  ],
  "components": [
    {
      "id": "mainContainer",
      "type": "container",
      "properties": {
        "backgroundColor": "#0f0f0f",
        "padding": "24px"
      },
      "children": [
        {
          "id": "header",
          "type": "container",
          "properties": {
            "direction": "row",
            "justifyContent": "space-between",
            "marginBottom": "24px"
          },
          "children": [
            {
              "id": "title",
              "type": "text",
              "properties": {
                "value": "Knowledge Admin Dashboard",
                "size": "h1",
                "color": "#ffffff",
                "weight": "bold"
              }
            },
            {
              "id": "statsContainer",
              "type": "container",
              "properties": {
                "direction": "row",
                "gap": "16px"
              },
              "children": [
                {
                  "type": "statistic",
                  "properties": {
                    "label": "Total Entries",
                    "value": "{{ getKnowledgeEntries.data?.total || 0 }}",
                    "size": "small"
                  }
                },
                {
                  "type": "statistic",
                  "properties": {
                    "label": "Pending Insights",
                    "value": "{{ getPendingInsights.data?.length || 0 }}",
                    "size": "small",
                    "color": "{{ getPendingInsights.data?.length > 0 ? 'warning' : 'default' }}"
                  }
                }
              ]
            }
          ]
        },
        {
          "id": "tabContainer",
          "type": "tabs",
          "properties": {
            "defaultTab": "upload"
          },
          "tabs": [
            {
              "id": "upload",
              "label": "Upload & Create",
              "components": [
                {
                  "id": "uploadSection",
                  "type": "container",
                  "properties": {
                    "direction": "row",
                    "gap": "24px"
                  },
                  "children": [
                    {
                      "id": "fileUploadCard",
                      "type": "card",
                      "properties": {
                        "title": "Document Upload",
                        "backgroundColor": "#1a1a1a",
                        "width": "50%"
                      },
                      "children": [
                        {
                          "id": "fileUploader",
                          "type": "fileDropzone",
                          "properties": {
                            "accept": ".pdf,.doc,.docx,.txt,.csv,.xlsx",
                            "maxFiles": 1,
                            "text": "Drop a file or click to upload"
                          }
                        },
                        {
                          "type": "container",
                          "properties": {
                            "marginTop": "16px",
                            "gap": "12px"
                          },
                          "children": [
                            {
                              "id": "sourceInput",
                              "type": "textInput",
                              "properties": {
                                "label": "Source",
                                "placeholder": "e.g., Sales Training Manual"
                              }
                            },
                            {
                              "id": "tagsInput",
                              "type": "multiselect",
                              "properties": {
                                "label": "Tags",
                                "placeholder": "Select or create tags",
                                "allowCustomValues": true,
                                "options": ["sales", "product", "pricing", "competition", "training", "policy"]
                              }
                            },
                            {
                              "id": "prioritySelect",
                              "type": "select",
                              "properties": {
                                "label": "Priority",
                                "options": [
                                  { "value": "high", "label": "High Priority" },
                                  { "value": "medium", "label": "Medium Priority" },
                                  { "value": "low", "label": "Low Priority" }
                                ],
                                "defaultValue": "medium"
                              }
                            },
                            {
                              "type": "button",
                              "properties": {
                                "text": "Upload Document",
                                "color": "primary",
                                "onClick": "{{ uploadDocument.trigger() }}",
                                "disabled": "{{ !fileUploader.value || fileUploader.value.length === 0 }}"
                              }
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "id": "manualEntryCard",
                      "type": "card",
                      "properties": {
                        "title": "Manual Entry",
                        "backgroundColor": "#1a1a1a",
                        "width": "50%"
                      },
                      "children": [
                        {
                          "id": "typeSelect",
                          "type": "select",
                          "properties": {
                            "label": "Entry Type",
                            "options": [
                              { "value": "fact", "label": "Fact/Information" },
                              { "value": "policy", "label": "Policy/Procedure" },
                              { "value": "faq", "label": "FAQ" },
                              { "value": "insight", "label": "Business Insight" }
                            ],
                            "defaultValue": "fact"
                          }
                        },
                        {
                          "id": "contentEditor",
                          "type": "textArea",
                          "properties": {
                            "label": "Content",
                            "placeholder": "Enter knowledge content...",
                            "rows": 8
                          }
                        },
                        {
                          "type": "button",
                          "properties": {
                            "text": "Create Entry",
                            "color": "primary",
                            "onClick": "{{ createKnowledgeEntry.trigger() }}",
                            "disabled": "{{ !contentEditor.value || contentEditor.value.trim() === '' }}",
                            "marginTop": "16px"
                          }
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "id": "discovery",
              "label": "Discovery Queue",
              "components": [
                {
                  "id": "discoveryContainer",
                  "type": "container",
                  "properties": {
                    "gap": "16px"
                  },
                  "children": [
                    {
                      "type": "text",
                      "properties": {
                        "value": "AI-Discovered Insights from Gong Calls",
                        "size": "h3",
                        "color": "#ffffff",
                        "marginBottom": "16px"
                      }
                    },
                    {
                      "id": "insightsList",
                      "type": "listView",
                      "properties": {
                        "data": "{{ getPendingInsights.data }}",
                        "height": "500px",
                        "itemTemplate": {
                          "type": "card",
                          "properties": {
                            "backgroundColor": "#1a1a1a",
                            "padding": "16px",
                            "marginBottom": "12px",
                            "onClick": "{{ selectedInsight.setValue(item) }}"
                          },
                          "children": [
                            {
                              "type": "container",
                              "properties": {
                                "direction": "row",
                                "justifyContent": "space-between",
                                "marginBottom": "12px"
                              },
                              "children": [
                                {
                                  "type": "text",
                                  "properties": {
                                    "value": "{{ item.type }}",
                                    "weight": "bold",
                                    "color": "{{ item.type === 'competitor' ? '#ef4444' : item.type === 'feature_request' ? '#3b82f6' : '#10b981' }}"
                                  }
                                },
                                {
                                  "type": "text",
                                  "properties": {
                                    "value": "{{ moment(item.discovered_at).fromNow() }}",
                                    "size": "small",
                                    "color": "#888"
                                  }
                                }
                              ]
                            },
                            {
                              "type": "text",
                              "properties": {
                                "value": "{{ item.content }}",
                                "color": "#ffffff",
                                "marginBottom": "8px"
                              }
                            },
                            {
                              "type": "text",
                              "properties": {
                                "value": "Source: {{ item.source }}",
                                "size": "small",
                                "color": "#888"
                              }
                            },
                            {
                              "type": "container",
                              "properties": {
                                "direction": "row",
                                "gap": "8px",
                                "marginTop": "12px"
                              },
                              "children": [
                                {
                                  "type": "button",
                                  "properties": {
                                    "text": "Approve",
                                    "color": "success",
                                    "size": "small",
                                    "onClick": "{{ approveInsight.trigger() }}"
                                  }
                                },
                                {
                                  "type": "button",
                                  "properties": {
                                    "text": "Edit & Approve",
                                    "color": "primary",
                                    "size": "small",
                                    "onClick": "{{ editModal.open() }}"
                                  }
                                },
                                {
                                  "type": "button",
                                  "properties": {
                                    "text": "Reject",
                                    "color": "danger",
                                    "size": "small",
                                    "onClick": "{{ rejectModal.open() }}"
                                  }
                                },
                                {
                                  "type": "button",
                                  "properties": {
                                    "text": "Ask Later",
                                    "style": "outline",
                                    "size": "small",
                                    "onClick": "{{ askLaterInsight.trigger() }}"
                                  }
                                }
                              ]
                            }
                          ]
                        }
                      }
                    }
                  ]
                }
              ]
            },
            {
              "id": "test",
              "label": "Test & Refine",
              "components": [
                {
                  "id": "testContainer",
                  "type": "container",
                  "properties": {
                    "gap": "24px"
                  },
                  "children": [
                    {
                      "id": "testCard",
                      "type": "card",
                      "properties": {
                        "title": "Knowledge Base Testing",
                        "backgroundColor": "#1a1a1a"
                      },
                      "children": [
                        {
                          "id": "testQueryInput",
                          "type": "textInput",
                          "properties": {
                            "placeholder": "Ask a question to test the knowledge base...",
                            "size": "large"
                          }
                        },
                        {
                          "type": "button",
                          "properties": {
                            "text": "Test Query",
                            "color": "primary",
                            "onClick": "{{ testKnowledge.trigger() }}",
                            "disabled": "{{ !testQueryInput.value }}",
                            "marginTop": "12px"
                          }
                        }
                      ]
                    },
                    {
                      "id": "testResultsCard",
                      "type": "card",
                      "properties": {
                        "title": "Test Results",
                        "backgroundColor": "#1a1a1a",
                        "hidden": "{{ !testKnowledge.data }}"
                      },
                      "children": [
                        {
                          "type": "text",
                          "properties": {
                            "value": "Answer:",
                            "weight": "bold",
                            "marginBottom": "8px"
                          }
                        },
                        {
                          "type": "text",
                          "properties": {
                            "value": "{{ testKnowledge.data?.answer }}",
                            "marginBottom": "16px"
                          }
                        },
                        {
                          "type": "text",
                          "properties": {
                            "value": "Sources:",
                            "weight": "bold",
                            "marginBottom": "8px"
                          }
                        },
                        {
                          "type": "listView",
                          "properties": {
                            "data": "{{ testKnowledge.data?.sources }}",
                            "itemTemplate": {
                              "type": "container",
                              "properties": {
                                "padding": "8px",
                                "backgroundColor": "#2a2a2a",
                                "borderRadius": "4px",
                                "marginBottom": "4px"
                              },
                              "children": [
                                {
                                  "type": "text",
                                  "properties": {
                                    "value": "{{ item.source }} (Score: {{ item.score }})",
                                    "size": "small"
                                  }
                                }
                              ]
                            }
                          }
                        },
                        {
                          "type": "container",
                          "properties": {
                            "direction": "row",
                            "gap": "12px",
                            "marginTop": "16px"
                          },
                          "children": [
                            {
                              "type": "button",
                              "properties": {
                                "text": "Good Answer",
                                "color": "success",
                                "style": "outline",
                                "onClick": "{{ submitFeedback.trigger({ quality: 'good' }) }}"
                              }
                            },
                            {
                              "type": "button",
                              "properties": {
                                "text": "Needs Improvement",
                                "color": "warning",
                                "style": "outline",
                                "onClick": "{{ feedbackModal.open() }}"
                              }
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "id": "manage",
              "label": "Manage Entries",
              "components": [
                {
                  "id": "searchBar",
                  "type": "container",
                  "properties": {
                    "direction": "row",
                    "gap": "12px",
                    "marginBottom": "16px"
                  },
                  "children": [
                    {
                      "id": "searchInput",
                      "type": "textInput",
                      "properties": {
                        "placeholder": "Search knowledge base...",
                        "width": "40%"
                      }
                    },
                    {
                      "id": "tagFilter",
                      "type": "multiselect",
                      "properties": {
                        "placeholder": "Filter by tags",
                        "options": ["sales", "product", "pricing", "competition", "training", "policy"],
                        "width": "25%"
                      }
                    },
                    {
                      "id": "sourceFilter",
                      "type": "select",
                      "properties": {
                        "placeholder": "Filter by source",
                        "options": "{{ utils.getUniqueSources(getKnowledgeEntries.data) }}",
                        "width": "25%"
                      }
                    },
                    {
                      "type": "button",
                      "properties": {
                        "text": "Search",
                        "color": "primary",
                        "onClick": "{{ searchKnowledge.trigger() }}"
                      }
                    }
                  ]
                },
                {
                  "id": "entriesTable",
                  "type": "table",
                  "properties": {
                    "data": "{{ searchKnowledge.data || getKnowledgeEntries.data?.data }}",
                    "columns": [
                      {
                        "key": "content",
                        "label": "Content",
                        "width": "40%",
                        "truncate": true
                      },
                      {
                        "key": "source",
                        "label": "Source",
                        "width": "20%"
                      },
                      {
                        "key": "tags",
                        "label": "Tags",
                        "width": "15%",
                        "render": "{{ utils.renderTags(item.tags) }}"
                      },
                      {
                        "key": "priority",
                        "label": "Priority",
                        "width": "10%",
                        "render": "{{ utils.renderPriority(item.priority) }}"
                      },
                      {
                        "key": "created_at",
                        "label": "Created",
                        "width": "15%",
                        "format": "datetime"
                      }
                    ],
                    "rowActions": [
                      {
                        "label": "Edit",
                        "onClick": "{{ editEntryModal.open(item) }}"
                      },
                      {
                        "label": "Delete",
                        "onClick": "{{ deleteEntry.trigger({ id: item.id }) }}",
                        "color": "danger"
                      }
                    ],
                    "backgroundColor": "#1a1a1a",
                    "pagination": {
                      "enabled": true,
                      "pageSize": 20,
                      "showPageSizeOptions": true
                    }
                  }
                }
              ]
            }
          ]
        }
      ]
    }
  ],
  "modals": [
    {
      "id": "editModal",
      "title": "Edit Insight",
      "components": [
        {
          "id": "insightEditor",
          "type": "textArea",
          "properties": {
            "label": "Content",
            "defaultValue": "{{ selectedInsight.value?.content }}",
            "rows": 6
          }
        },
        {
          "id": "insightPrioritySelect",
          "type": "select",
          "properties": {
            "label": "Priority",
            "options": [
              { "value": "high", "label": "High" },
              { "value": "medium", "label": "Medium" },
              { "value": "low", "label": "Low" }
            ],
            "defaultValue": "medium"
          }
        }
      ],
      "footer": [
        {
          "type": "button",
          "properties": {
            "text": "Cancel",
            "onClick": "{{ editModal.close() }}"
          }
        },
        {
          "type": "button",
          "properties": {
            "text": "Save & Approve",
            "color": "primary",
            "onClick": "{{ approveInsight.trigger() && editModal.close() }}"
          }
        }
      ]
    },
    {
      "id": "rejectModal",
      "title": "Reject Insight",
      "components": [
        {
          "id": "rejectionReason",
          "type": "textArea",
          "properties": {
            "label": "Reason for Rejection",
            "placeholder": "Please provide a reason...",
            "rows": 4
          }
        }
      ],
      "footer": [
        {
          "type": "button",
          "properties": {
            "text": "Cancel",
            "onClick": "{{ rejectModal.close() }}"
          }
        },
        {
          "type": "button",
          "properties": {
            "text": "Reject",
            "color": "danger",
            "onClick": "{{ rejectInsight.trigger() && rejectModal.close() }}"
          }
        }
      ]
    }
  ],
  "utils": {
    "renderTags": "function(tags) { if (!tags || tags.length === 0) return ''; return tags.map(tag => `<span class='tag'>${tag}</span>`).join(' ') }",
    "renderPriority": "function(priority) { const colors = { high: '#ef4444', medium: '#f59e0b', low: '#10b981' }; return `<span style='color: ${colors[priority]}'>${priority.toUpperCase()}</span>` }",
    "getUniqueSources": "function(data) { if (!data) return []; const sources = data.map(item => item.source).filter(Boolean); return [...new Set(sources)] }",
    "formatBytes": "function(bytes) { if (bytes === 0) return '0 Bytes'; const k = 1024; const sizes = ['Bytes', 'KB', 'MB', 'GB']; const i = Math.floor(Math.log(bytes) / Math.log(k)); return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i] }"
  },
  "state": {
    "selectedInsight": {
      "initialValue": null,
      "persist": false
    },
    "pagination": {
      "initialValue": {
        "currentPage": 1,
        "pageSize": 20
      },
      "persist": false
    }
  },
  "styles": {
    "global": {
      "fontFamily": "'Inter', -apple-system, BlinkMacSystemFont, sans-serif",
      "backgroundColor": "#0f0f0f",
      "color": "#ffffff"
    },
    "components": {
      ".tag": {
        "backgroundColor": "#3b82f6",
        "color": "#ffffff",
        "padding": "2px 6px",
        "borderRadius": "4px",
        "fontSize": "11px",
        "marginRight": "4px"
      }
    }
  }
}
